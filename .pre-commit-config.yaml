# ============================================================
# .pre-commit-config.yaml (Python Hygiene)
# ============================================================
# VARIANT: python-hygiene
# SOURCE: https://github.com/denisecase/templates
#
# REQ: Professional Python projects SHOULD include a .pre-commit-config.yaml
# to minimize git diffs and support collaboration.
# WHY: Provide fast, consistent checks before committing code.
#
# OBS: These hooks use and do NOT override:
#   - .editorconfig (whitespace / indentation)
#   - .gitattributes (EOL normalization)
#   - pyproject.toml (Python tool settings)
#
# OPTIONAL LOCAL USAGE (no repo venv required):
#   You must have uv installed locally.
#   Run these commands ONCE in from the repo root to enable pre-commit:
#
#   uv self update
#   uvx pre-commit install
#   uvx pre-commit run --all-files
#
# This enables the pre-commit hooks for this project repo.
# ALL subsequent commits in this repo will AUTOMATICALLY run these
# pre-commit hooks, after `git add` and before `git commit`.
#
# NOTE: enabling pre-commit is optional. It is not needed to clone or commit.

exclude: |
  (?x)^(
    \.DS_Store|
    \.coverage|
    \.ipynb_checkpoints/|
    \.mypy_cache/|
    \.nox/|
    \.pytest_cache/|
    \.ruff_cache/|
    \.tox/|
    \.venv/|
    .*\.(egg-info)/|
    .*\.log|
    __pycache__/|
    _minted.*/|
    build/|
    coverage\.xml|
    dist/|
    htmlcov/|
    lake-packages/|
    node_modules/|
    out/|
    site/
  )

repos:
  # === REPO: PRE-COMMIT HOOKS (cross-platform, zero config) ===
  #
  # These hooks prevent problems that show up later as:
  #   - mysterious diffs
  #   - broken builds on another OS

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # === PRE-COMMIT: NORMALIZE FILE FORMATTING ===

      - id: trailing-whitespace
        name: A1) Clean trailing whitespace (per .editorconfig)
        args: [--markdown-linebreak-ext=md] # Preserves markdown double-space line breaks

      - id: end-of-file-fixer
        name: A2) End files with a newline (per .gitattributes)

      - id: mixed-line-ending
        name: A3) Normalize line endings to LF before linters
        args: [--fix=lf] # OBS: Windows working copies may be CRLF.

      #  === PRE-COMMIT: CHECK DATA FILE FORMATS ===

      - id: check-json
        name: B1) Validate JSON syntax (except .vscode/)
        # WHY: VSCode settings may include comments, which are non-standard JSON.
        exclude: ^\.vscode/.*\.json$

      - id: check-toml
        name: B2) Validate TOML syntax

      - id: check-yaml
        name: B3) Validate YAML syntax
        files: \.(yml|yaml)$
        # WHY:
        #    VS Code config files are editor-specific
        #    mkdocs.yml may use YAML anchors not supported by the checker
        exclude: ^(\.vscode/|mkdocs\.ya?ml$)

      # === PRE-COMMIT:CHECK FOR COMMON PROBLEMS ===

      - id: check-added-large-files
        name: C1) Prevent accidental commits of large binaries
        args: [--maxkb=3000]

      - id: check-merge-conflict
        name: C2) Prevent committing merge conflicts

      - id: check-case-conflict
        name: C3) Check for filename case conflicts

  # === REPO: RUFF PRE-COMMIT (for Python code) ===

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      # === RUFF PRE-COMMIT CHECKS ===
      - id: ruff-format
        name: D1) Ruff format (before linting)

      - id: ruff
        name: D2) Ruff linter (autofix errors, style issues )
        args: [--fix, --exit-non-zero-on-fix]


# === GLOBAL SETTINGS ===
# ALT: Set fail_fast to true to stop at first failure.
fail_fast: false # Run all hooks even if one fails
